<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>Home. rangl 0.3.0.9001</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">rangl 0.3.0.9001</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="reference.html">Reference</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <div class="container">
      <header>
        
      </header>
      
      <div class="row">
  <div class="span8">
    <p><a href="https://travis-ci.org/r-gris/rangl"><img src="https://travis-ci.org/r-gris/rangl.svg?branch=master" alt="Travis-CI Build Status"/></a> <a href="https://ci.appveyor.com/project/r-gris/rangl"><img src="https://ci.appveyor.com/api/projects/status/github/r-gris/rangl?branch=master&amp;svg=true" alt="AppVeyor Build Status"/></a> <a href="https://codecov.io/github/r-gris/rangl?branch=master"><img src="https://img.shields.io/codecov/c/github/r-gris/rangl/master.svg" alt="Coverage Status"/></a></p>

<!-- README.md is generated from README.Rmd. Please edit that file -->

<h2>Tabular storage for spatial data</h2>

<p>The &#39;rangl&#39; package illustrates some generalizations of GIS-y tasks in R with &ldquo;tables&rdquo;.</p>

<p>The basic idea is to create &ldquo;toplogical&rdquo; objects from a variety of sources:</p>

<ul>
<li>  SpatialPolygons, SpatialLines, SpatialMultipoints</li>
<li>  rgl 3D objects</li>
<li>  trip objects (animal tracking data)</li>
<li>  &ndash;others to come&ndash; see <a href="https://github.com/mdsumner/spbabel">https://github.com/mdsumner/spbabel</a></li>
</ul>

<p>Multiple multi-part objects are decomposed to a set of related, linked tables. Object identity is maintained with attribute metadata and this is carried through to colour and other aesthetics in 3D plots.</p>

<p>Plot methods take those tables and generate the &ldquo;indexed array&rdquo; structures needed for &#39;rgl&#39;. In this way we get the best of both worlds of &ldquo;GIS&rdquo; and &ldquo;3D models&rdquo;.</p>

<h2>Ongoing design</h2>

<p>The core work for translating &ldquo;Spatial&rdquo; classes is done by the unspecialized &#39;spbabel::map_table&#39; function.</p>

<p>This is likely to be replaced by a &#39;primitives()&#39; function that takes any lines or polygons data and returns just the linked edges. Crucially, polygons and lines are described by the same 1D primitives, and this is easy to do. Harder is to generate 2D primitives and for that we rely on <a href="https://www.cs.cmu.edu/%7Equake/triangle.html">Jonathan Richard Shewchuk&#39;s Triangle</a>.</p>

<p>Triangulation is with <code>RTriangle</code> package using &ldquo;constrained mostly-Delaunay Triangulation&rdquo; from the Triangle library, but could alternatively use <code>rgl</code> with its ear clipping algorithm.</p>

<p>(With RTriangle we can set a max area for the triangles, so it can wrap around curves like globes and hills.)</p>

<h2>Installation</h2>

<p>This package is in active development and will see a number of breaking changes before release.</p>

<p>Also required are packages &#39;rgl&#39; and &#39;RTriangle&#39;, so first make sure you can install and use these.</p>

<pre><code class="r">install.packages(&quot;rgl&quot;)
install.packages(&quot;RTriangle&quot;)
</code></pre>

<p>In examples below I use &#39;graticule&#39; as well, so you might as well install that too.</p>

<pre><code class="r">install.packages(&quot;graticule&quot;)
</code></pre>

<p>If you are still feeling adventurous, &#39;rangl&#39; can be installed from Github. This will also ensure that the latest version of &#39;spbabel&#39; is installed, until I get around to updating that on CRAN.</p>

<pre><code class="r">devtools::install_github(&quot;r-gris/rangl&quot;)
</code></pre>

<h2>Get involved!</h2>

<p>Let me know if you have problems, or are interested in this work. See the issues tab to make suggestions or report bugs.</p>

<p><a href="https://github.com/r-gris/rangl/issues">https://github.com/r-gris/rangl/issues</a></p>

<h2>Examples</h2>

<p>Get some maps and plot in 3D - in plane view, or globe view.</p>

<p><strong>NOTE:</strong> these examples here just show snapshots. It&#39;s much more interesting to run these yourself locally and interact with the rgl plots.</p>

<pre><code class="r">
library(rgl)
library(maptools)
#&gt; Loading required package: sp
#&gt; Checking rgeos availability: TRUE
data(wrld_simpl)
library(raster)

## convert to triangles and plot 
library(rangl)
cmesh &lt;- rangl(wrld_simpl)
plot(cmesh)
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;triangle_&quot;

## snapshot code is only for this README
rgl.snapshot(&quot;readme-figure/README-wrld_simpl.png&quot;); rgl.clear()

sids &lt;- raster::shapefile(system.file(&quot;shapes/sids.shp&quot;, package=&quot;maptools&quot;))
#&gt; Warning in .local(x, ...): .prj file is missing
projection(sids) &lt;- &quot;+proj=longlat +ellps=clrk66&quot;

ex &lt;- extent(sids) + 5
gl &lt;- graticule::graticule(seq(xmin(ex), xmax(ex), length = 15), 
                           seq(ymin(ex), ymax(ex), length = 8))


## convert to triangles, but wrap onto globe then plot
smesh &lt;- rangl(sids)
plot(globe(smesh))
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;triangle_&quot;
mgl &lt;- rangl(gl)
mgl$o$color_ &lt;- &quot;black&quot;
plot(globe(mgl), lwd = 2)
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;segment_&quot;

rgl.snapshot(&quot;readme-figure/README-sids-globe.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-wrld_simpl.png?raw=true" alt="World simpl" title="World simpl"/></p>

<p><img src="readme-figure/README-sids-globe.png?raw=true" alt="SIDS globe" title="SIDS globe"/></p>

<h2>Holes are trivially supported.</h2>

<p>It&#39;s trivial to have &ldquo;holes&rdquo;, because there are no holes, because we have a true surface, composed of 2D primitives (triangles).</p>

<pre><code class="r">library(spbabel)
data(holey)

## SpatialPolygonsDataFrame
sph &lt;- sp(holey)

glh &lt;- rangl(sph)
plot(glh)
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;triangle_&quot;
rgl::rgl.snapshot(&quot;readme-figure/README-home.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-home.png?raw=true" alt="Holey home" title="Holey home"/></p>

<h2>Lines are supported.</h2>

<pre><code class="r">linehouse &lt;- as(sph, &quot;SpatialLinesDataFrame&quot;)
plot(rangl(linehouse))
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;segment_&quot;
rgl::rgl.snapshot(&quot;readme-figure/README-lines.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-lines.png?raw=true" alt="Liney lines" title="Liney lines"/></p>

<h2>Globe lines</h2>

<pre><code class="r">lmesh &lt;- rangl(as(wrld_simpl, &quot;SpatialLinesDataFrame&quot;))
plot(globe(lmesh))
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;segment_&quot;
rgl::rgl.snapshot(&quot;readme-figure/README-liney-world.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-liney-world.png?raw=true" alt="Liney world" title="Liney world"/></p>

<h2>Mesh3d rgl</h2>

<p>Rgl mesh3d objects that use &ldquo;triangle&rdquo; primitives are supported.</p>

<pre><code class="r">library(rgl)

dod &lt;- rangl(dodecahedron3d(col = &quot;cyan&quot;))
octo &lt;- rangl(translate3d(octahedron3d(col = &quot;blue&quot;), 6, 0, 0))
plot(dod, col = viridis::viridis(5)[1], alpha = 0.3)
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;triangle_&quot;
plot(octo, col = viridis::viridis(5)[5], alpha = 0.3)
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;triangle_&quot;
bg3d(&quot;grey&quot;)
rgl::rgl.snapshot(&quot;readme-figure/README-Platonic.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-Platonic.png?raw=true" alt="Platonic" title="Platonic"/></p>

<p>To complete the support for these rgl objects we need quads, and to allows a mix of quads and triangles in one data set (that&#39;s what <code>extrude3d</code> uses).</p>

<h2>Points</h2>

<p>And points work! (Don&#39;t laugh).</p>

<pre><code class="r">library(rangl)
library(maptools)
data(wrld_simpl)
mpts &lt;- as(as(wrld_simpl, &quot;SpatialLinesDataFrame&quot;), &quot;SpatialMultiPointsDataFrame&quot;)
plot(rangl(mpts))
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;branch_&quot;
rgl::view3d(theta = 25, phi = 3)
</code></pre>

<p><img src="readme-figure/README-MultiPoints.png?raw=true" alt="MultiPoints" title="MultiPoints"/></p>

<h2>Trips</h2>

<p>The soon to be released update to trip includes a &#39;walrus818&#39; data set courtesy of Anthony Fischbach. Zoom around and see if you can find them.</p>

<pre><code class="r">library(trip)
library(rangl)
data(walrus818)

library(graticule)
prj &lt;-&quot;+proj=laea +lon_0=0 +lat_0=90 +ellps=WGS84&quot;
gr &lt;- graticule(lats = seq(40, 85, by = 5), ylim = c(35, 89.5), proj = prj)
library(maptools)
data(wrld_simpl)

w &lt;- spTransform(subset(wrld_simpl, coordinates(wrld_simpl)[,2] &gt; -70),  prj)
library(graticule)
walrus &lt;- spTransform(walrus818, prj)

gr$color_ &lt;- &quot;black&quot;
rgl.close()
rgl::par3d(windowRect = c(100, 100, 912 + 100, 912 +100))
plot(rangl(gr))
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;segment_&quot;
w$color_ &lt;- sample(viridis::inferno(nrow(w)))
plot(rangl(w), specular = &quot;black&quot;)
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;triangle_&quot;
plot(rangl(walrus))
#&gt; Joining, by = &quot;object_&quot;
#&gt; Joining, by = &quot;segment_&quot;
um &lt;- structure(c(0.934230506420135, 0.343760699033737, 0.0950899347662926, 
0, -0.302941381931305, 0.905495941638947, -0.297159105539322, 
0, -0.188255190849304, 0.24880850315094, 0.950081348419189, 0, 
0, 0, 0, 1), .Dim = c(4L, 4L))
par3d(userMatrix = um)
rgl::rgl.snapshot(&quot;readme-figure/README-walrus.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-walrus.png?raw=true" alt="Walrus" title="Walrus"/></p>

<h2>Rasters</h2>

<p>Single layer rasters are supported.</p>

<pre><code class="r">wrld &lt;- rasterize(wrld_simpl, raster())
plot(rangl(wrld/10))
rgl::rgl.snapshot(&quot;readme-figure/README-raster.png&quot;); rgl.clear()

plot(globe(rangl(wrld*100000)), specular = &quot;black&quot;)
rgl::rgl.snapshot(&quot;readme-figure/README-rasterglobe.png&quot;); rgl.clear()
</code></pre>

<p><img src="readme-figure/README-raster.png?raw=true" alt="Raster" title="Raster"/></p>

<p><img src="readme-figure/README-rasterglobe.png?raw=true" alt="RasterGlobe" title="RasterGlobe"/></p>

<h2>Open topics</h2>

<ul>
<li>  single-points are a bit funny, it&#39;s wasteful to copy the branches model - needs thought</li>
<li>  multi-points are also a bit funny, but this will form the basis of input tracking data for some applications</li>
</ul>

<p>Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). By participating in this project you agree to abide by its terms.</p>

  </div>

  <div class="span3 offset1 sidebar">
        <h2>Authors</h2>
    <ul>
      <li><a href='mailto:mdsumner@gmail.com'>Michael D. Sumner</a> [aut, cre]</li>
    </ul>
  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="https://getbootstrap.com/2.0.4/">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>